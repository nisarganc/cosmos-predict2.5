Bootstrap: docker
From: dockerhub-mirror3.rrze.uni-erlangen.de/nvidia/cuda:12.8.1-cudnn-devel-ubuntu24.04

%files
    . /workspace

%environment
    export UV_COMPILE_BYTECODE=1
    export UV_LINK_MODE=copy
    export UV_TOOL_BIN_DIR=/usr/local/bin

    export SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt
    export REQUESTS_CA_BUNDLE=$SSL_CERT_FILE
    export CURL_CA_BUNDLE=$SSL_CERT_FILE

    export PATH="/workspace/.venv/bin:$PATH"

%post
    set -e
    
    mkdir -p /workspace
    cd /workspace

    apt-get update && \
    apt-get install -y --no-install-recommends \
        curl \
        ffmpeg \
        git \
        libgl1 \
        libglib2.0-0 \
        tree \
        wget \
        ca-certificates && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

    curl -LsSf https://astral.sh/uv/0.8.12/install.sh | env UV_INSTALL_DIR=/usr/local/bin UV_NO_MODIFY_PATH=1 sh

    uv sync


%runscript
    exec /workspace/.venv/bin/activate "$@"